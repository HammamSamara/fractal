<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="icon" type="image/x-icon" href="/themes/thephpleague/thephpleague.github.com/img/favicon.ico" />
                <link rel="apple-touch-icon-precomposed" href="/themes/thephpleague/thephpleague.github.com/img/apple-touch-icon-precomposed.png">
                <title>Serializers - Fractal</title>
                <meta name="description" content="Fractal provides a presentation and transformation layer for complex data output, the like found in AJAX and RESTful APIs.">
                <link rel="stylesheet" href="/themes/thephpleague/thephpleague.github.com/css/all.css">
    </head>
<body>

<section class="all_packages">
    <a href="http://thephpleague.com/">
        <img src="/themes/thephpleague/thephpleague.github.com/img/loep_logo.png" width="195" height="200" alt="The League of Extraordinary Packages">
    </a>
    <h2>Our Packages:</h2>
    <ul>
    </ul>
</section>

<header>
    <a class="logo" href="/">
                <span class="name">Fractal</span>
        <span class="tagline">Output complex, flexible, AJAX/RESTful data structures.</span>
    </a>
    <a href="http://thephpleague.com/" class="league">
        Presented by The League of Extraordinary Packages
    </a>
</header>

<input type="checkbox" id="menu">
<label for="menu" onclick>
    <div class="closed">&#9776; Menu</div>
    <div class="open">&#9776; Hide Menu</div>
</label>

<main>
    <menu>
                    <h2>Getting Started</h2>
            <ul>
                                    <li >
                        <a href="/">Introduction</a>
                    </li>
                                    <li >
                        <a href="/simple-example/">Simple Example</a>
                    </li>
                                    <li >
                        <a href="/installation/">Installation</a>
                    </li>
                                    <li >
                        <a href="/glossary/">Glossary</a>
                    </li>
                            </ul>
                    <h2>Concepts</h2>
            <ul>
                                    <li >
                        <a href="/resources/">Resources</a>
                    </li>
                                    <li class="selected">
                        <a href="/serializers/">Serializers</a>
                    </li>
                                    <li >
                        <a href="/transformers/">Transformers</a>
                    </li>
                                    <li >
                        <a href="/pagination/">Pagination</a>
                    </li>
                            </ul>
            </menu>
    <article>
        <h1>Serializers</h1>

<p>A <em>Serializer</em> structures your <em>Transformed</em> data in certain ways. There are many output
structures for APIs, two popular ones being <a href="http://stateless.co/hal_specification.html">HAL</a> and <a href="http://jsonapi.org/">JSON-API</a>. Twitter and Facebook output data
differently to each other, and Google does it differently too. Most of the differences between these
serializers are how data is namespaced.</p>

<p><em>Serializer</em> classes let you switch between various output formats with minimal effect on your <em>Transformers</em>.</p>

<p>A very basic usage of Fractal will look like this, as has been seen in other sections:</p>

<pre><code class="language-php">use Acme\Model\Book;
use Acme\Transformer\BookTransformer;
use League\Fractal\Manager;
use League\Fractal\Resource\Item;
use League\Fractal\Serializer\DataArraySerializer;

$manager = new Manager();
$manager-&gt;setSerializer(new DataArraySerializer());

// Some sort of ORM call
$book = Book::find(1);

// Make a resource out of the data and 
$resource = new Item($book, new BookTransformer(), 'book');

// Run all transformers
$manager-&gt;createData($resource)-&gt;toArray();

// Outputs:
// [
//     'data' =&gt; [
//         'id' =&gt; 'Foo',
//         'title' =&gt; 'Foo',
//         'year' =&gt; 1991,
//     ],
// ];
</code></pre>

<p>What is new here is the <code>$manager-&gt;setSerializer(new DataArraySerializer());</code> part. 
<code>DataArraySerializer</code> is the name of the default serializer in Fractal, but there are more.</p>

<h2>DataArraySerializer</h2>

<p>This serializer is not to everyones tastes, because it adds a <code>'data'</code> namespace to the output:</p>

<pre><code class="language-php">// Item
[
    'data' =&gt; [
        'foo' =&gt; 'bar'
    ],
];

// Collection
[
    'data' =&gt; [
        [
            'foo' =&gt; 'bar'
        ]
    ],
];
</code></pre>

<p>This is handy because it allows space for meta data (like pagination, or totals) in both Items and 
Collections.</p>

<pre><code class="language-php">// Item with Meta
[
    'data' =&gt; [
        'foo' =&gt; 'bar'
    ],
    'meta' =&gt; [
        ...
    ]
];

// Collection with Meta
[
    'data' =&gt; [
        [
            'foo' =&gt; 'bar'
        ]
    ],
    'meta' =&gt; [
        ...
    ]
];
</code></pre>

<p>This fits in nicely for meta and included resources, using the <code>'data'</code> namespace. This means meta data 
can be added for those included resources too.</p>

<pre><code class="language-php">// Item with included resource using meta
[
    'data' =&gt; [
        'foo' =&gt; 'bar'
        'comments' =&gt; [
            'data' =&gt; [
                ...
            ],
            'meta' =&gt; [
                ...
            ]
        ]
    ],
];
</code></pre>

<h2>ArraySerializer</h2>

<p>Sometimes people want to remove that <code>'data'</code> namespace for items, and that can be done using the <code>ArraySerializer</code>,
which is mostly the same other than that namespace. This serializer makes content look a lot like Twitter
API responses.</p>

<pre><code class="language-php">use League\Fractal\Serializer\ArraySerializer;
$manager-&gt;setSerializer(new ArraySerializer());
</code></pre>

<pre><code class="language-php">// Item
[
    'foo' =&gt; 'bar'
];

// Collection
[
    'data' =&gt; [
        'foo' =&gt; 'bar'
    ]
];
</code></pre>

<p>Meta data is merged in to the root level of the data for items to keep things clean, but a <code>'data'</code> namespace is added 
for collections, and meta data sits next to that:</p>

<pre><code class="language-php">// Item with Meta
[
    'foo' =&gt; 'bar'
    'meta' =&gt; [
        ...
    ]
];

// Collection with Meta
[
    'data' =&gt; [
        'foo' =&gt; 'bar'
    ]
    'meta' =&gt; [
        ...
    ]
];
</code></pre>

<p>Adding a namespace for collections is required to avoid problems with mixing non-numeric indexes with numeric indexes. Basically put, while PHP is happy to mix the two, JSON cannot. An array with some undefined (numeric by default) indexes, and some named will be converted into an object with numeric strings as keys:</p>

<blockquote>
  <p>{"0":{"foo":"bar"},"meta":{}}</p>
</blockquote>

<p>Complicated, but if you want to use meta data in your collections then you will have to accept the extra namespace.</p>

<h2>JsonApiSerializer</h2>

<p>This is a work in progress representation of the <a href="http://jsonapi.org/">JSON-API</a> standard. It is included as it is partially working, but has some work left.</p>

<p>There are few differences with the <code>JsonApiSerializer</code>. The first is that it uses "side-loading" to include
other related resources, which is different from the "embedding" approach that is used to include resources
by the other two serializers.</p>

<p>The second is that it requires a <em>Resource Key</em>, which the other two do not.</p>

<pre><code class="language-php">use League\Fractal\Serializer\JsonApiSerializer;
$manager-&gt;setSerializer(new JsonApiSerializer());

// Important, notice the Resource Key in the third parameter:
$resource = new Item($book, new GenericBookTransformer(), 'book');
$resource = new Collection($books, new GenericBookTransformer(), 'books');
</code></pre>

<p>That resource key is used to give it a named namespace:</p>

<pre><code class="language-php">// Item
[
    'book' =&gt; [
        'foo' =&gt; 'bar'
    ],
];

// Collection
[
    'books' =&gt; [
        [
            'foo' =&gt; 'bar'
        ]
    ],
];
</code></pre>

<p>Just like <code>DataArraySerializer</code>, this works nicely for meta data:</p>

<pre><code class="language-php">// Item with Meta
[
    'book' =&gt; [
        'foo' =&gt; 'bar'
    ],
    'meta' =&gt; [
        ...
    ]
];

// Collection with Meta
[
    'books' =&gt; [
        [
            'foo' =&gt; 'bar'
        ]
    ],
    'meta' =&gt; [
        ...
    ]
];
</code></pre>

<p>Adding a resource to a item response would look like this:</p>

<pre><code class="language-php">// Item with Meta
[
    'book' =&gt; [
        'foo' =&gt; 'bar'
    ],
    'linked' =&gt; [
        'author' =&gt; [
            [
                'name' =&gt; 'Dave'
            ]
        ]
    ]
];
</code></pre>

<h2>Custom Serializers</h2>

<p>You can make your own Serializers by implementing <a href="https://github.com/thephpleague/fractal/blob/master/src/Serializer/SerializerAbstract.php">SerializerAbstract</a>.</p>

<pre><code class="language-php">use Acme\Serializer\CustomSerializer;
$manager-&gt;setSerializer(new CustomSerializer());
</code></pre>

<p>Setting up this class will require reference to a few things:</p>

<pre><code class="language-php">namespace Acme\Serializer;

use League\Fractal\Pagination\CursorInterface;
use League\Fractal\Pagination\PaginatorInterface;
use League\Fractal\Serializer\SerializerAbstract;

class CustomSerializer extends SerializerAbstract
{
    // ... 
}
</code></pre>

<p>Most of the core serializers use "meta" and "data", but other people want different terms and different structures
for their data. If for example you want a collection to wrap any resources in an array with an index of <code>"items"</code> then
all that needs to be done is implement the following <code>collection()</code> method with that as a return.</p>

<pre><code class="language-php">    /**
     * Serialize a collection
     * 
     * @param  string  $resourceKey
     * @param  array  $data
     * @return array
     **/
    public function collection($resourceKey, array $data)
    {
        return ['items' =&gt; $data];
    }
</code></pre>

<p>If no namespace should go around an item then simply return that data directly:</p>

<pre><code class="language-php">    /**
     * Serialize an item
     * 
     * @param  string  $resourceKey
     * @param  array  $data
     * @return array
     **/
    public function item($resourceKey, array $data)
    {
        return $data;
    }
</code></pre>

<p>Both of these methods have ignored the <code>$resourceKey</code> argument in this serializer. It is there if the serializer requires it, but can be used at any point. Sometimes wrapping included data with an extra array is more useful, and that would be done in the <code>includedData()</code> method:</p>

<pre><code class="language-php">    /**
     * Serialize the included data
     * 
     * @param  string  $resourceKey
     * @param  array  $data
     * @return array
     **/
    public function includedData($resourceKey, array $data)
    {
        return [$resourceKey =&gt; $data];
    }
</code></pre>

<p>Meta Data for things like pagination will be done with the <code>meta()</code> method, and the name of the array key can be changed here. In this instance it is changed to <code>'stuff'</code>:</p>

<pre><code class="language-php">    /**
     * Serialize the meta
     * 
     * @param  array  $meta
     * @return array
     **/
    public function meta(array $meta)
    {
        if (empty($meta)) {
            return array();
        }

        return ['stuff' =&gt; $meta];
    }
</code></pre>

<p>Paginator output again is just an array, so any sort of structure can be built. There is a lot of data returned by the core serializers, but you can restrict this by just returning less stuff from the <code>paginator()</code> method. The following will only return links to next and previous pages if they are available.</p>

<pre><code class="language-php">    /**
     * Serialize the paginator
     *
     * @param PaginatorInterface $paginator
     * @return array
     **/
    public function paginator(PaginatorInterface $paginator)
    {
        $currentPage = (int) $paginator-&gt;getCurrentPage();
        $lastPage = (int) $paginator-&gt;getLastPage();

        $links = [];

        if ($currentPage &gt; 1) {
            $links['previous'] = $paginator-&gt;getUrl($currentPage - 1);
        }

        if ($currentPage &lt; $lastPage) {
            $links['next'] = $paginator-&gt;getUrl($currentPage + 1);
        }

        return ['pages' =&gt; $links];
    }
</code></pre>

<p>Cursors are a little more simple to serialize, and look like this:</p>

<pre><code class="language-php">    /**
     * Serialize the cursor
     * 
     * @param  CursorInterface  $cursor
     * @return array
     **/
    public function cursor(CursorInterface $cursor)
    {
        $cursor = [
            'current' =&gt; $cursor-&gt;getCurrent(),
            'prev' =&gt; $cursor-&gt;getPrev(),
            'next' =&gt; $cursor-&gt;getNext(),
            'count' =&gt; (int) $cursor-&gt;getCount(),
        ];

        return ['cursor' =&gt; $cursor];
    }
</code></pre>

<p>Any of those methods can be changed around and different arrays can be built to represent stuff in different ways.</p>
    </article>
</main>

<footer>
    <span>&copy; Copyright The League of Extraordinary Packages.</span>
    <span>Site design by <a href="http://reinink.ca">Jonathan Reinink</a>.</span>
    <span>Powered by <a href="https://sculpin.io">Sculpin</a>.</span>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/themes/thephpleague/thephpleague.github.com/js/scripts.js"></script>
<script src="/themes/thephpleague/thephpleague.github.com/js/prism.js"></script>

    <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-46050814-4');ga('send','pageview');
    </script>

</body>
</html>